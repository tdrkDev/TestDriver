name: Build lab tests
on: push
jobs:
  build-linux:
    name: Build (Linux)
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v5
    
      - name: Build
        run: |
          cmake -H. -Bbuild -DCMAKE_BUILD_TYPE=Release -G Ninja
          cmake --build build
      
      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: testlab_lnx.zip
          path: build/testlab*
          if-no-files-found: error

  build-windows:
    name: Build (Windows)
    runs-on: windows-latest
    steps:
    - uses: actions/checkout@v5
    
    - name: Build
      run: |
        cmake -S. -Bbuild -DCMAKE_BUILD_TYPE=Release -G Ninja
        cmake --build build --config Release
    
    - name: Upload artifacts
      uses: actions/upload-artifact@v4
      with:
        name: testlab_win.zip
        path: build/testlab*.exe
        if-no-files-found: error
  
  build-macos:
    name: Build (macOS)
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v5
      
      - name: Build
        run: |
          cmake -S. -Bbuild -DCMAKE_BUILD_TYPE=Release -DCMAKE_OSX_ARCHITECTURES=x86_64\;arm64 -G Ninja
          cmake --build build --config Release
          find build -type f -name "testlab*" -exec mv {} {}_mac \;
          
      - name: Upload artifacts
        uses: actions/upload-artifact@v4
        with:
          name: testlab_macos.zip
          path: build/testlab*
          if-no-files-found: error
          retention-days: 1
